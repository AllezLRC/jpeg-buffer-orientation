{"version":3,"file":"index.min.js","sources":["../src/global-this.js","../src/constants.js","../src/validate-exif-data.js","../src/is-boolean.js","../src/is-tiff-align-little-endian.js","../src/index.js","../src/is-jpeg.js","../src/get-exif-position.js","../src/get-orientation.js"],"sourcesContent":["// eslint-disable-next-line no-new-func\nconst globalThis = new Function('return this')()\n\nexport default globalThis\n","// https://www.media.mit.edu/pia/Research/deepview/exif.html\nexport const SOI_MARKER = 0xffd8\nexport const APP1_MARKER = 0xffe1\nexport const EXIF_START = 0x45786966\nexport const TIFF_ALIGN_INTEL = 0x4949\nexport const TIFF_ALIGN_MOTOROLA = 0x4d4d\nexport const TIFF_TAG_MARK = 0x002a\nexport const TIFF_FIRST_IFD_OFFSET = 0x00000008\nexport const TIFF_ORIENTATION_TAG_NO = 0x0112\n","import {EXIF_START, TIFF_FIRST_IFD_OFFSET, TIFF_TAG_MARK} from './constants'\nimport isLittleEndia from './is-tiff-align-little-endian'\nimport isBoolean from './is-boolean'\n\nfunction validateEXIFData(view, offset) {\n  // Not valid EXIF data! NO 'Exif' found\n  if (\n    view.getUint32(offset) !== EXIF_START ||\n    view.getUint16(offset + 4) !== 0x0000\n  ) {\n    return false\n  }\n\n  const tiffOffset = offset + 6\n  const littleEndian = isLittleEndia(view, tiffOffset)\n\n  /* istanbul ignore if */\n  if (!isBoolean(littleEndian)) {\n    return false\n  }\n\n  /* istanbul ignore if */\n  // \"Not valid TIFF data! (no 0x002A)\"\n  if (view.getUint16(tiffOffset + 2, littleEndian) !== TIFF_TAG_MARK) {\n    return false\n  }\n\n  const firstIFDOffset = view.getUint32(tiffOffset + 4, littleEndian)\n\n  /* istanbul ignore if */\n  if (firstIFDOffset < TIFF_FIRST_IFD_OFFSET) {\n    // Not valid TIFF data! (First offset less than 8)\n    return false\n  }\n\n  return {\n    tiffOffset,\n    littleEndian,\n    firstIFDOffset,\n  }\n}\n\nexport default validateEXIFData\n","function isBoolean(x) {\n  return x === true || x === false\n}\n\nexport default isBoolean\n","import {TIFF_ALIGN_MOTOROLA, TIFF_ALIGN_INTEL} from './constants'\n\nfunction isLittleEndian(view, offset) {\n  const tiffAlign = view.getUint16(offset)\n\n  if (tiffAlign === TIFF_ALIGN_INTEL) {\n    return true\n  }\n\n  /* istanbul ignore else */\n  if (tiffAlign === TIFF_ALIGN_MOTOROLA) {\n    return false\n  }\n\n  /* istanbul ignore next */\n  // \"Not valid TIFF data! (no 0x4949 or 0x4D4D)\"\n  return null\n}\n\nexport default isLittleEndian\n","// get orientation from a Arraybuffer\n// most codes from urls bellow\n// https://github.com/dominictarr/exif-orientation-lite/blob/master/index.js\n// https://github.com/exif-js/exif-js/blob/master/exif.js\n\nimport globalThis from './global-this'\nimport isJPEG from './is-jpeg'\nimport getExifPosition from './get-exif-position'\nimport getOrientation from './get-orientation'\n\nconst {DataView} = globalThis\n\nfunction orientation(buffer) {\n  const view = new DataView(buffer)\n\n  if (!isJPEG(view)) {\n    return\n  }\n\n  const exifOffset = getExifPosition(view)\n\n  if (!exifOffset) {\n    return\n  }\n\n  return getOrientation(view, exifOffset)\n}\n\nexport default orientation\n","import {SOI_MARKER} from './constants'\n\nfunction isJPEG(view) {\n  return view.getUint16(0) === SOI_MARKER\n}\n\nexport default isJPEG\n","import {APP1_MARKER} from './constants'\n\n// https://github.com/dominictarr/exif-orientation-lite/blob/master/index.js\n// https://github.com/exif-js/exif-js/blob/master/exif.js\n\nfunction getExifPosition(view) {\n  const {byteLength} = view\n\n  let offset = 2\n  while (offset < byteLength) {\n    // Not a valid marker\n    if (view.getUint8(offset) !== 0xff) {\n      return null\n    }\n\n    const marker = view.getUint16(offset)\n\n    if (marker === APP1_MARKER) {\n      return offset + 4\n    }\n\n    offset += 2\n    offset += view.getUint16(offset)\n  }\n\n  /* istanbul ignore next */\n  return null\n}\n\nexport default getExifPosition\n","import {TIFF_ORIENTATION_TAG_NO} from './constants'\n\nimport validateEXIFData from './validate-exif-data'\n\nfunction getOrientation(view, offset) {\n  const result = validateEXIFData(view, offset)\n\n  if (!result) {\n    return\n  }\n\n  const {tiffOffset, littleEndian, firstIFDOffset} = result\n\n  const tags = view.getUint16(firstIFDOffset, littleEndian)\n  const start = tiffOffset + firstIFDOffset\n\n  for (let i = 0; i < tags; i += 1) {\n    const entryOffset = start + i * 12 + 2\n\n    if (entryOffset > view.byteLength - 16) {\n      return\n    }\n\n    // skip type check\n    // var type = view.getUint16(entryOffset+2, littleEndian)\n    // var numValues = view.getUint32(entryOffset+4, littleEndian)\n    const tiffTagNumber = view.getUint16(entryOffset, littleEndian)\n    if (tiffTagNumber === TIFF_ORIENTATION_TAG_NO) {\n      const orientation = view.getUint16(entryOffset + 8, littleEndian)\n      if (orientation < 1 || orientation > 8) {\n        return\n      }\n      return orientation\n    }\n  }\n}\n\nexport default getOrientation\n"],"names":["globalThis","Function","SOI_MARKER","APP1_MARKER","EXIF_START","TIFF_ALIGN_INTEL","TIFF_ALIGN_MOTOROLA","TIFF_TAG_MARK","TIFF_FIRST_IFD_OFFSET","TIFF_ORIENTATION_TAG_NO","validateEXIFData","view","offset","getUint32","getUint16","x","tiffOffset","littleEndian","tiffAlign","isLittleEndia","firstIFDOffset","DataView","buffer","isJPEG","exifOffset","byteLength","getUint8","getExifPosition","result","tags","start","i","entryOffset","orientation","getOrientation"],"mappings":"oMACA,IAAMA,EAAa,IAAIC,SAAS,cAAb,GCANC,EAAa,MACbC,EAAc,MACdC,EAAa,WACbC,EAAmB,MACnBC,EAAsB,MACtBC,EAAgB,GAChBC,EAAwB,EACxBC,EAA0B,ICJvC,SAASC,EAAiBC,EAAMC,MAG5BD,EAAKE,UAAUD,KAAYR,GACI,IAA/BO,EAAKG,UAAUF,EAAS,UAEjB,MCVQG,EDaXC,EAAaJ,EAAS,EACtBK,EEZR,SAAwBN,EAAMC,OACtBM,EAAYP,EAAKG,UAAUF,UAE7BM,IAAcb,GAKda,IAAcZ,GAMX,KFFca,CAAcR,EAAMK,OCb5B,KADID,EDiBFE,KChBY,IAANF,SDiBZ,KAKLJ,EAAKG,UAAUE,EAAa,EAAGC,KAAkBV,SAC5C,MAGHa,EAAiBT,EAAKE,UAAUG,EAAa,EAAGC,WAGlDG,EAAiBZ,IAKd,CACLQ,WAAAA,EACAC,aAAAA,EACAG,eAAAA,OG5BGC,EAAYrB,EAAZqB,gBAEP,SAAqBC,OACbX,EAAO,IAAIU,EAASC,MCX5B,SAAgBX,UACPA,EAAKG,UAAU,KAAOZ,EDYxBqB,CAAOZ,QAINa,EEdR,SAAyBb,WAChBc,EAAcd,EAAdc,WAEHb,EAAS,EACNA,EAASa,GAAY,IAEI,MAA1Bd,EAAKe,SAASd,UACT,QAGMD,EAAKG,UAAUF,KAEfT,SACNS,EAAS,EAGlBA,GAAU,EACVA,GAAUD,EAAKG,UAAUF,UAIpB,KFPYe,CAAgBhB,MAE9Ba,SGjBP,SAAwBb,EAAMC,OACtBgB,EAASlB,EAAiBC,EAAMC,MAEjCgB,UAIEZ,EAA4CY,EAA5CZ,WAAYC,EAAgCW,EAAhCX,aAAcG,EAAkBQ,EAAlBR,eAE3BS,EAAOlB,EAAKG,UAAUM,EAAgBH,GACtCa,EAAQd,EAAaI,EAElBW,EAAI,EAAGA,EAAIF,EAAME,GAAK,EAAG,KAC1BC,EAAcF,EAAY,GAAJC,EAAS,KAEjCC,EAAcrB,EAAKc,WAAa,aAOdd,EAAKG,UAAUkB,EAAaf,KAC5BR,EAAyB,KACvCwB,EAActB,EAAKG,UAAUkB,EAAc,EAAGf,MAChDgB,EAAc,GAAKA,EAAc,gBAG9BA,IHPJC,CAAevB,EAAMa"}