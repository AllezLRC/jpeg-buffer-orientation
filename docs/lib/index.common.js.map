{"version":3,"file":"index.common.js","sources":["../src/global-this.js","../src/constants.js","../src/is-jpeg.js","../src/get-exif-position.js","../src/is-tiff-align-little-endian.js","../src/is-boolean.js","../src/validate-exif-data.js","../src/get-orientation.js","../src/index.js"],"sourcesContent":["// eslint-disable-next-line no-new-func\nconst globalThis = new Function('return this')()\n\nexport default globalThis\n","// https://www.media.mit.edu/pia/Research/deepview/exif.html\nexport const SOI_MARKER = 0xffd8\nexport const APP1_MARKER = 0xffe1\nexport const EXIF_START = 0x45786966\nexport const TIFF_ALIGN_INTEL = 0x4949\nexport const TIFF_ALIGN_MOTOROLA = 0x4d4d\nexport const TIFF_TAG_MARK = 0x002a\nexport const TIFF_FIRST_IFD_OFFSET = 0x00000008\nexport const TIFF_ORIENTATION_TAG_NO = 0x0112\n","import {SOI_MARKER} from './constants'\n\nfunction isJPEG(view) {\n  return view.getUint16(0) === SOI_MARKER\n}\n\nexport default isJPEG\n","import {APP1_MARKER} from './constants'\n\n// https://github.com/dominictarr/exif-orientation-lite/blob/master/index.js\n// https://github.com/exif-js/exif-js/blob/master/exif.js\n\nfunction getExifPosition(view) {\n  const {byteLength} = view\n\n  let offset = 2\n  while (offset < byteLength) {\n    // Not a valid marker\n    if (view.getUint8(offset) !== 0xff) {\n      return null\n    }\n\n    const marker = view.getUint16(offset)\n\n    if (marker === APP1_MARKER) {\n      return offset + 4\n    }\n\n    offset += 2\n    offset += view.getUint16(offset)\n  }\n\n  return null\n}\n\nexport default getExifPosition\n","import {TIFF_ALIGN_MOTOROLA, TIFF_ALIGN_INTEL} from './constants'\n\nfunction isLittleEndian(view, offset) {\n  const tiffAlign = view.getUint16(offset)\n\n  if (tiffAlign === TIFF_ALIGN_MOTOROLA) {\n    return false\n  }\n\n  if (tiffAlign === TIFF_ALIGN_INTEL) {\n    return true\n  }\n\n  // \"Not valid TIFF data! (no 0x4949 or 0x4D4D)\"\n  return null\n}\n\nexport default isLittleEndian\n","function isBoolean(x) {\n  return x === true || x === false\n}\n\nexport default isBoolean\n","import {EXIF_START, TIFF_FIRST_IFD_OFFSET, TIFF_TAG_MARK} from './constants'\nimport isLittleEndia from './is-tiff-align-little-endian'\nimport isBoolean from './is-boolean'\n\nfunction validateEXIFData(view, offset) {\n  // Not valid EXIF data! NO 'Exif' found\n  if (view.getUint32(offset) !== EXIF_START) {\n    return false\n  }\n\n  const tiffOffset = offset + 6\n  const littleEndian = isLittleEndia(view, tiffOffset)\n\n  if (!isBoolean(littleEndian)) {\n    return false\n  }\n\n  // \"Not valid TIFF data! (no 0x002A)\"\n  if (view.getUint16(tiffOffset + 2, littleEndian) !== TIFF_TAG_MARK) {\n    return false\n  }\n\n  const firstIFDOffset = view.getUint32(tiffOffset + 4, littleEndian)\n\n  if (firstIFDOffset < TIFF_FIRST_IFD_OFFSET) {\n    // Not valid TIFF data! (First offset less than 8)\n    return false\n  }\n\n  return {\n    tiffOffset,\n    littleEndian,\n    firstIFDOffset,\n  }\n}\n\nexport default validateEXIFData\n","import {TIFF_ORIENTATION_TAG_NO} from './constants'\n\nimport validateEXIFData from './validate-exif-data'\n\nfunction getOrientation(view, offset) {\n  const result = validateEXIFData(view, offset)\n\n  if (!result) {\n    return null\n  }\n\n  const {tiffOffset, littleEndian, firstIFDOffset} = result\n\n  const tags = view.getUint16(firstIFDOffset, littleEndian)\n  const dirStart = tiffOffset + firstIFDOffset\n\n  for (let i = 0; i < tags; i++) {\n    const entryOffset = dirStart + i * 12 + 2\n    // skip type check\n    // var type = view.getUint16(entryOffset+2, littleEndian)\n    // var numValues = view.getUint32(entryOffset+4, littleEndian)\n    const tiffTagNumber = view.getUint16(entryOffset, littleEndian)\n    if (tiffTagNumber === TIFF_ORIENTATION_TAG_NO) {\n      const orientation = view.getUint16(entryOffset + 8, littleEndian)\n      if (orientation < 1 || orientation > 8) {\n        return null\n      }\n      return orientation\n    }\n  }\n\n  return null\n}\n\nexport default getOrientation\n","// get orientation from a Arraybuffer\n// most codes from urls bellow\n// https://github.com/dominictarr/exif-orientation-lite/blob/master/index.js\n// https://github.com/exif-js/exif-js/blob/master/exif.js\n\nimport globalThis from './global-this'\nimport isJPEG from './is-jpeg'\nimport getExifPosition from './get-exif-position'\nimport getOrientation from './get-orientation'\n\nconst {DataView} = globalThis\n\nfunction orientation(buffer) {\n  const view = new DataView(buffer)\n\n  if (!isJPEG(view)) {\n    return null\n  }\n\n  const exifOffset = getExifPosition(view)\n\n  if (!exifOffset) {\n    return null\n  }\n\n  return getOrientation(view, exifOffset)\n}\n\nexport default orientation\n"],"names":["globalThis","Function","SOI_MARKER","APP1_MARKER","EXIF_START","TIFF_ALIGN_INTEL","TIFF_ALIGN_MOTOROLA","TIFF_TAG_MARK","TIFF_FIRST_IFD_OFFSET","TIFF_ORIENTATION_TAG_NO","isJPEG","view","getUint16","getExifPosition","byteLength","offset","getUint8","marker","isLittleEndian","tiffAlign","isBoolean","x","validateEXIFData","getUint32","tiffOffset","littleEndian","isLittleEndia","firstIFDOffset","getOrientation","result","tags","dirStart","i","entryOffset","tiffTagNumber","orientation","DataView","buffer","exifOffset"],"mappings":"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"}